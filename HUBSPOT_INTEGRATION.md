# Интеграция пайплайна с HubSpot

## Обзор

Эта интеграция позволяет системе проверять наличие данных о компаниях в HubSpot перед обработкой и использовать уже имеющиеся описания, если они достаточно свежие (менее 6 месяцев). Это позволяет:
1. Сократить время обработки компаний
2. Сократить расходы на API запросы 
3. Сохранять консистентность данных

## Настройка

### 1. API ключ HubSpot

Для работы интеграции необходимо получить API ключ HubSpot и добавить его в файл `.env`:

```
HUBSPOT_API_KEY=your_hubspot_api_key_here
```

### 2. Структура данных в HubSpot

Для корректной работы интеграции в HubSpot должны быть настроены следующие свойства компании:
- `website` - веб-сайт компании (используется для поиска)
- `description` - текстовое описание компании
- `description_timestamp` - временная метка последнего обновления описания в формате ISO
- `linkedin_url` - URL профиля LinkedIn компании (опционально)

### 3. Конфигурация

В файле `llm_config.yaml` можно настроить параметры интеграции:

```yaml
# HubSpot интеграция
hubspot_api_key: "your_hubspot_api_key_here"  # Можно указать здесь вместо .env
use_hubspot_integration: true                 # Включение/отключение интеграции
hubspot_description_max_age_months: 6         # Максимальный возраст описания в месяцах
```

## Принцип работы

1. Система получает URL сайта компании из второй колонки входного файла
2. Система проверяет наличие компании в HubSpot по доменному имени
3. Если компания найдена:
   - Проверяется наличие и свежесть описания
   - Если описание свежее, оно используется напрямую и дальнейшая обработка пропускается
   - Если описание отсутствует или устарело, запускается стандартный пайплайн обработки
4. Если компания не найдена, запускается стандартный пайплайн обработки

## Улучшение производительности и надежности

1. **Кэширование** - результаты поиска в HubSpot кэшируются во избежание повторных запросов
2. **Обработка ошибок** - при сбоях в API HubSpot процесс продолжит работу через стандартный пайплайн
3. **Логирование** - все операции с HubSpot детально логируются для отладки

## Расширение

Для дальнейшего развития интеграции рекомендуется:
1. Добавить функциональность обновления данных в HubSpot после обработки компании
2. Реализовать асинхронный клиент для HubSpot API для повышения производительности
3. Добавить пакетную загрузку данных о компаниях из HubSpot для предварительной фильтрации

## Возможные проблемы и решения

| Проблема | Решение |
|----------|---------|
| API ключ HubSpot недействителен | Проверьте корректность ключа в .env или llm_config.yaml |
| Компания не находится в HubSpot | Убедитесь, что домен в HubSpot совпадает с доменом во входном файле |
| Превышение лимитов API HubSpot | Увеличьте интервал между запросами или запросите увеличение лимитов | 
# Тестирование функциональности Predator в HubSpot

## Обзор

Этот набор скриптов предназначен для тестирования всех операций с полем `gcore_predator_id` в HubSpot, чтобы убедиться в корректности реализации в основном проекте.

## Тестовые скрипты

### 1. `test_predator_operations.py` - Полное тестирование
Комплексный тест всех операций с predator_id:
- ✅ Поиск компании по домену
- ✅ Чтение текущего значения predator_id
- ✅ Запись различных значений (383, 999, 0, 1234)
- ✅ Очистка поля разными способами
- ✅ Анализ пустых значений
- ✅ Восстановление исходных данных

**Запуск:**
```bash
python test_predator_operations.py
```

### 2. `test_predator_simple.py` - Быстрый тест
Упрощенная версия для быстрой проверки:
- Поиск компании Wargaming
- Запись значения 383
- Проверка чтения
- Очистка поля
- Восстановление

**Запуск:**
```bash
python test_predator_simple.py
```

### 3. `test_hubspot_predator.py` - Тест через адаптер
Тестирование через HubSpotAdapter (как в основном проекте):
- Использует высокоуровневые методы адаптера
- Проверяет интеграцию с основным кодом

**Запуск:**
```bash
python test_hubspot_predator.py
```

## Тестовые данные

Используется компания из последней сессии:
- **Компания:** Wargaming Group Limited
- **Домен:** wargaming.com
- **Test Predator ID:** 383

## Что проверяют тесты

### 1. Типы данных
- Как HubSpot хранит числовые значения
- Как выглядят пустые значения (None, "", 0)
- Соответствие типов при чтении/записи

### 2. Операции записи
- Запись положительных чисел
- Запись нуля
- Обработка строковых значений
- Конвертация в числовой формат

### 3. Операции чтения
- Получение текущего значения
- Проверка типов возвращаемых данных
- Обработка пустых значений

### 4. Операции очистки
- Очистка через `None`
- Очистка через пустую строку
- Проверка результата очистки

### 5. Условия проверки
Тестируются различные способы проверки пустых значений:
```python
# Что возвращает HubSpot для пустого predator_id?
value is None           # ?
value == None          # ?
value == ''            # ?
value == 0             # ?
bool(value)            # ?
not value              # ?
```

## Ожидаемые результаты

Основываясь на реализации в проекте, ожидаем:

1. **Числовые значения** записываются как `int`
2. **Пустые значения** возвращаются как `None` или отсутствуют в ответе
3. **Проверка пустоты** должна быть: `if predator_id is not None and predator_id != ""`
4. **Чтение пустого поля** возвращает `None`

## Возможные проблемы

### Проблема 1: Условие `if predator_id:`
```python
# ❌ НЕ РАБОТАЕТ для predator_id = "0"
if predator_id:
    # Код не выполнится для "0"
    
# ✅ ПРАВИЛЬНО
if predator_id is not None and predator_id != "":
    # Работает для всех значений включая "0"
```

### Проблема 2: Конвертация типов
```python
# ❌ Может упасть на пробелах
int(predator_id)

# ✅ ПРАВИЛЬНО
int(predator_id.strip()) if isinstance(predator_id, str) else int(predator_id)
```

### Проблема 3: Сравнение значений
```python
# ❌ Может не сработать из-за типов
if predator_from_file != predator_from_hubspot:

# ✅ ПРАВИЛЬНО
if predator_from_file != str(predator_from_hubspot):
```

## Результаты тестирования

После запуска тестов вы получите информацию о:
- Как HubSpot хранит и возвращает predator_id
- Какие проверки нужно использовать в коде
- Правильно ли реализованы операции в основном проекте

## Требования

- Python 3.7+
- Установленные зависимости проекта
- Настроенная переменная окружения `HUBSPOT_API_KEY`
- Доступ к HubSpot аккаунту с компанией Wargaming

## Безопасность

⚠️ **Внимание:** Тесты изменяют данные в реальном HubSpot аккаунте!
- Все изменения логируются
- Исходные значения восстанавливаются после тестов
- При ошибках может потребоваться ручное восстановление 
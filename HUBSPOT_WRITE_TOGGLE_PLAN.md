# План добавления свитчера для контроля записи в HubSpot

## Цель
Добавить красивый свитчер в UI для выбора, записывать ли результаты в HubSpot или нет. При этом функциональность проверки существующих данных в HubSpot должна остаться неизменной.

## Требования
- ✅ Проверка существующих данных в HubSpot работает всегда (для пропуска обработки)
- ✅ Свитчер контролирует только запись новых/обновленных результатов в HubSpot
- ✅ Красивый UI элемент (toggle switch)
- ✅ Сохранение настройки в метаданных сессии
- ✅ Передача параметра через весь pipeline

## Детальный план реализации

### 1. Frontend изменения
- [x] Добавить красивый toggle switch в `frontend/index.html`
- [x] Стилизовать свитчер с современным дизайном
- [x] Добавить описание функциональности
- [x] Обновить `frontend/app.js` для отправки параметра

### 2. Backend API изменения
- [x] Добавить параметр `write_to_hubspot` в `backend/main.py:create_new_session()`
- [x] Сохранить настройку в метаданных сессии
- [x] Передать параметр в `backend/processing_runner.py`

### 3. Pipeline адаптер изменения
- [x] Обновить `src/pipeline/adapter.py` для передачи параметра
- [x] Обновить `src/integrations/hubspot/adapter.py` для использования флага
- [x] Убедиться что проверка HubSpot работает независимо от флага записи

### 4. Core pipeline изменения
- [x] Обновить `src/pipeline/core.py:_process_single_company_async()`
- [x] Добавить условие для записи в HubSpot на основе флага
- [x] Сохранить логику проверки существующих данных

### 5. HubSpot интеграция
- [ ] Разделить логику проверки и записи в HubSpot адаптере
- [ ] Добавить параметр `write_enabled` в методы записи
- [ ] Обновить логирование для отражения статуса записи

### 6. UI/UX улучшения
- [ ] Добавить иконки и подсказки к свитчеру
- [ ] Показать статус записи в HubSpot в результатах
- [ ] Обновить прогресс-бар с информацией о HubSpot

### 7. Тестирование
- [ ] Протестировать с включенной записью в HubSpot
- [ ] Протестировать с отключенной записью в HubSpot
- [ ] Убедиться что проверка существующих данных работает в обоих случаях
- [ ] Проверить сохранение настройки в сессии

## Технические детали

### Новые параметры:
- `write_to_hubspot: bool` - флаг для контроля записи
- По умолчанию: `true` (для обратной совместимости)

### Изменения в метаданных сессии:
```json
{
  "write_to_hubspot": true,
  "hubspot_write_status": "enabled|disabled"
}
```

### Логика работы:
1. **Проверка HubSpot** - всегда выполняется для пропуска обработки
2. **Запись в HubSpot** - выполняется только если `write_to_hubspot = true`
3. **UI отображение** - показывает статус записи в результатах

## Ожидаемый результат
- Красивый toggle switch в UI
- Полный контроль над записью в HubSpot
- Сохранение всей существующей функциональности проверки
- Улучшенная информативность в логах и UI 
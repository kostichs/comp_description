# Company Canvas v10 Deployment Commands

# 1. Pull new version v10
docker pull sergeykostichev/company-canvas-app:v10

# 2. Stop and remove old container
docker stop company-canvas-prod
docker rm company-canvas-prod

# 3. Create data directories if they don't exist
sudo mkdir -p /srv/company-canvas/output
sudo chown -R $USER:$USER /srv/company-canvas/output

# 4. Create sessions_metadata.json if it doesn't exist
if [ ! -f /srv/company-canvas/sessions_metadata.json ]; then
    echo '[]' > /srv/company-canvas/sessions_metadata.json
    echo "Created empty sessions_metadata.json"
fi
chmod 666 /srv/company-canvas/sessions_metadata.json

# 5. Start new version v10 with all features
docker run -d --restart unless-stopped --name company-canvas-prod -p 80:8000 \
  -e OPENAI_API_KEY="YOUR_OPENAI_KEY" \
  -e SERPER_API_KEY="YOUR_SERPER_KEY" \
  -e SCRAPINGBEE_API_KEY="YOUR_SCRAPINGBEE_KEY" \
  -e HUBSPOT_API_KEY="YOUR_HUBSPOT_KEY" \
  -e HUBSPOT_BASE_URL="https://app.hubspot.com/contacts/YOUR_PORTAL_ID/record/0-2/" \
  -e DEBUG="false" \
  -v /srv/company-canvas/output:/app/output \
  -v /srv/company-canvas/sessions_metadata.json:/app/sessions_metadata.json \
  sergeykostichev/company-canvas-app:v10

# 6. Check deployment status
docker ps

# 7. Check logs
docker logs company-canvas-prod

# 8. Monitor logs in real-time (optional)
# docker logs -f company-canvas-prod

# New Features in v10:
# - FIXED: Results display logic - ALL completed NTH analyses now appear in "All Results"
# - FIXED: Zero NTH score results now display full analysis data instead of "NOT QUALIFIED"
# - FIXED: Auto-refresh of latest session info on criteria tab after completion on main tab
# - FIXED: GPT result matching logic - correct individual criterion evaluation (no more false positives)
# - IMPROVED: Clear distinction between failed qualification/mandatory vs completed analysis
# - ENHANCED: Performance optimizations with balanced API rate limiting

# Expected Behavior:
# - Companies that fail qualification/mandatory → "NOT QUALIFIED" with reason
# - Companies that reach NTH analysis (even 0 score) → Full results with detailed data
# - Latest session info auto-updates between tabs without manual refresh (F5)

# Test the deployment:
# 1. Process companies on first tab
# 2. Check that latest session auto-updates on second tab
# 3. Verify that zero-score NTH results appear in "All Results" 